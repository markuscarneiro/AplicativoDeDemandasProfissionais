{% extends 'base.html' %}
{% load static %}

{% block title %}Login - {{ block.super }}{% endblock %}

{% block extra_css %}
<!-- CSS específico para login com background -->
<link rel="stylesheet" href="{% static 'demandas/css/login-background.css' %}">
<link rel="stylesheet" href="{% static 'demandas/css/login-config.css' %}">
<link rel="stylesheet" href="{% static 'demandas/css/login-gradients.css' %}">
<link rel="stylesheet" href="{% static 'demandas/css/login-fixes.css' %}">

<!-- CSS inline para background e correções -->
<style>
    /* Background principal */
    body.login-page {
        background-image: url('{% static "demandas/images/background-login.jpg" %}') !important;
        background-size: cover !important;
        background-position: center !important;
        background-repeat: no-repeat !important;
        background-attachment: fixed !important;
        background-color: #667eea !important;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
    }
    
    /* Remove navbar */
    .navbar {
        display: none !important;
    }
    
    /* Correções específicas para campos */
    .login-page .form-label {
        color: #ffffff !important;
        font-weight: 600 !important;
        margin-bottom: 0.5rem !important;
        font-size: 0.95rem !important;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.7) !important;
        display: block !important;
    }
    
    .login-page .form-label i {
        margin-right: 0.5rem !important;
        color: #ffffff !important;
    }
    
    .login-page .form-control {
        background-color: rgba(255, 255, 255, 0.95) !important;
        border: 2px solid rgba(255, 255, 255, 0.3) !important;
        color: #212529 !important;
        font-size: 16px !important;
        padding: 0.75rem 1rem !important;
        border-radius: 0.5rem !important;
        margin-top: 0.25rem !important;
        height: 48px !important;
    }
    
    .login-page .form-control:focus {
        background-color: rgba(255, 255, 255, 1) !important;
        border-color: #0d6efd !important;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25) !important;
    }
    
    .login-page .mb-3 {
        margin-bottom: 1.5rem !important;
    }
    
    /* Campo de senha específico */
    .login-page input[type="password"] {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
        letter-spacing: 0.1em !important;
    }
    
    /* Ajustes específicos para o ícone SVG e header */
    .login-header {
        padding: 2rem 2rem 2.2rem 2rem !important;
    }
    
    .login-header svg {
        display: block;
        margin: 0 auto 0.5rem auto !important;
        position: relative;
        z-index: 2;
    }
    
    .login-header h3 {
        margin-bottom: 0.3rem !important;
        line-height: 1.2 !important;
    }
    
    .login-header p {
        margin-bottom: 0 !important;
        line-height: 1.1 !important;
    }
</style>
{% endblock %}

{% block body_class %}login-page{% endblock %}

{% block content %}
<!-- Container com classe especial para background -->
<!-- 
    PERSONALIZAÇÃO:
    Para alterar o tema, adicione uma das classes:
    - theme-professional (padrão)
    - theme-corporate
    - theme-modern
    - theme-dark
    - theme-minimal
    
    Para usar apenas gradiente (sem imagem), adicione:
    - gradient-only gradient-professional
    - gradient-only gradient-modern
    - gradient-only gradient-animated
    
    Exemplos:
    <div class="login-page-body theme-corporate">
    <div class="login-page-body gradient-only gradient-modern">
-->
<div class="login-page-body">
    <div class="login-container">
        <div class="card login-card">
            <!-- Header do Login -->
            <div class="login-header">
                <!-- Ícone de Órbitas Gravitacionais SVG -->
                <svg width="80" height="80" viewBox="0 0 80 80" xmlns="http://www.w3.org/2000/svg" style="margin-bottom: 0.5rem;">
                    <!-- Órbita externa (maior) - rotação 0° -->
                    <ellipse cx="40" cy="40" rx="32" ry="16" 
                             stroke="white" 
                             stroke-width="3" 
                             fill="none" 
                             opacity="0.8"/>
                    
                    <!-- Órbita média - rotação 60° -->
                    <ellipse cx="40" cy="40" rx="25" ry="12.5" 
                             stroke="white" 
                             stroke-width="3" 
                             fill="none" 
                             opacity="0.9"
                             transform="rotate(60 40 40)"/>
                    
                    <!-- Órbita interna (menor) - rotação 120° -->
                    <ellipse cx="40" cy="40" rx="17" ry="8.5" 
                             stroke="white" 
                             stroke-width="3" 
                             fill="none" 
                             opacity="1"
                             transform="rotate(120 40 40)"/>
                    
                    <!-- Núcleo gravitacional central -->
                    <circle cx="40" cy="40" r="8.5" fill="white"/>
                </svg>
                <h3 class="mb-0">QUASAR GRAVITON</h3>
                <p class="mb-0 opacity-75">Gestão de Demandas</p>
            </div>
            
            <!-- Corpo do Login -->
            <div class="login-body">
                <!-- Mensagens de Erro -->
                {% if form.errors %}
                    <div class="error-messages">
                        <i class="bi bi-exclamation-triangle"></i>
                        <strong>Erro no login:</strong>
                        {% for field, errors in form.errors.items %}
                            <ul>
                                {% for error in errors %}
                                    <li>{{ error }}</li>
                                {% endfor %}
                            </ul>
                        {% endfor %}
                    </div>
                {% endif %}
                
                <!-- Formulário de Login -->
                <form method="post">
                    {% csrf_token %}
                    
                    <!-- Campo Usuário -->
                    <div class="mb-3">
                        <label for="id_username" class="form-label">
                            <i class="bi bi-person"></i>
                            Nome de usuário
                        </label>
                        <input 
                            type="text" 
                            class="form-control" 
                            id="id_username" 
                            name="username" 
                            placeholder="Digite seu nome de usuário"
                            value="{{ form.username.value|default:'' }}"
                            required
                            autofocus
                        >
                    </div>
                    
                    <!-- Campo Senha -->
                    <div class="mb-3">
                        <label for="id_password" class="form-label">
                            <i class="bi bi-lock"></i>
                            Senha
                        </label>
                        <input 
                            type="password" 
                            class="form-control" 
                            id="id_password" 
                            name="password" 
                            placeholder="Digite sua senha"
                            autocomplete="current-password"
                            required
                        >
                    </div>
                    
                    <!-- Hidden field para redirecionamento -->
                    {% if next %}
                        <input type="hidden" name="next" value="{{ next }}">
                    {% endif %}
                    
                    <!-- Botão de Login -->
                    <button type="submit" class="btn btn-primary btn-login">
                        <i class="bi bi-box-arrow-in-right"></i>
                        Entrar no Sistema
                    </button>
                </form>
                
                <!-- Link Esqueceu a Senha -->
                <div class="forgot-password">
                    <a href="#" onclick="alert('Funcionalidade em desenvolvimento')">
                        <i class="bi bi-question-circle"></i>
                        Esqueceu sua senha?
                    </a>
                </div>
            </div>
            
            <!-- Footer do Login -->
            <div class="login-footer">
                <i class="bi bi-info-circle"></i>
                Use suas credenciais para acessar o sistema
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Inicialização da página de login
    document.addEventListener('DOMContentLoaded', function() {
        // Foco automático no campo de usuário
        const usernameField = document.getElementById('id_username');
        if (usernameField && !usernameField.value) {
            setTimeout(() => usernameField.focus(), 300);
        }
        
        // Garantir que o campo de senha funcione corretamente
        const passwordField = document.getElementById('id_password');
        if (passwordField) {
            // Força atributos do campo de senha
            passwordField.setAttribute('autocomplete', 'current-password');
        }
    });
    
    // Efeitos visuais nos campos de input
    document.querySelectorAll('.form-control').forEach(function(input) {
        input.addEventListener('focus', function() {
            this.style.borderColor = '#0d6efd';
            this.style.boxShadow = '0 0 0 0.2rem rgba(13, 110, 253, 0.25)';
        });
        
        input.addEventListener('blur', function() {
            this.style.borderColor = 'rgba(255, 255, 255, 0.3)';
            this.style.boxShadow = 'none';
        });
    });
    
    // Animação de loading no botão de submit
    document.querySelector('form').addEventListener('submit', function() {
        const submitBtn = this.querySelector('.btn-login');
        if (submitBtn) {
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Verificando...';
            submitBtn.disabled = true;
            
            // Reabilita o botão após 10 segundos caso haja erro
            setTimeout(() => {
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }, 10000);
        }
    });
    
    // Suporte para tecla Enter nos campos
    document.querySelectorAll('.form-control').forEach(function(input) {
        input.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                const form = this.closest('form');
                const submitBtn = form.querySelector('.btn-login');
                if (submitBtn) {
                    submitBtn.click();
                }
            }
        });
    });
</script>
{% endblock %}